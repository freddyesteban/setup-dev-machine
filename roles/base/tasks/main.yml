
- name: Create local binaries directory
  file:
    path: "{{ item }}"
    state: directory
    mode: '0750'
    owner: "{{ ansible_env.USER }}"
  loop:
    - "{{ ansible_env.HOME }}/.local"
    - "{{ ansible_env.HOME }}/.local/bin"
  tags:
    - always
    - create-local-bin

- name: Copy zprofile to ~/.zprofile
  template:
    src: zprofile
    dest: "{{ ansible_env.HOME}}/.zprofile"
  tags:
    - always
    - zsh-dotfiles

- name: Copy zshrc to ~/.myzshrc
  template:
    src: zshrc
    dest: "{{ ansible_env.HOME}}/.myzshrc"
  tags:
    - always
    - zsh-dotfiles

- name: Ensure ~/.myzshrc is sourced when shell is started
  lineinfile:
    path: "{{ ansible_env.HOME}}/.zshrc"
    state: present
    line: source {{ ansible_env.HOME}}/.myzshrc

- name: Install CLI development tools
  community.general.homebrew:
    name: "{{ item }}"
    state: present
  loop:
    - cmake
    - git
    - httpie
    - jq
    - the_silver_searcher
    - tree
    - gettext
    - watch
    - libpq
    - gnu-tar
    - postgresql
    - krew
  tags:
    - install-cli-tools

- name: Install Homebrew Cask apps
  ignore_errors: yes
  community.general.homebrew:
    name: "{{ item }}"
    state: present
  loop:
    - appcleaner
    - caffeine
    - iterm2
    - macvim
  tags:
    - install-apps
